<html>
{% load static %} 
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href={% static './css/b_detail.css' %}>
    </head>
    <body>
        {% include 'nav.html' %}
        <div class="head-wrapper">
            <h1>{{ comm.title }}</h1>
            <div class="userbox">
                <a href="{% url 'board_update' pk=comm.pk %}">수정하기</a>
                <a href="{% url 'board_delete' pk=comm.pk %}">삭제하기</a>
            </div>
            <div class="inform">
                <div class="writer">{{ comm.user.nickname }}</div>
                <div class="date">{{ comm.date }}</div> 
            </div>
        </div>
        <div class="postsection">
            {% if comm.file %}
            <a href="{{comm.file.url }}" download>
                <div class="downbox">
                    <span class="chumboo">첨부파일</span>
                    <span class="filename">vkdlf.jpeg</span>
                    <img class="downicon" src={% static './img/download.png' %} />
                </div>
            </a>
            {% endif %} 
            {{ comm.text }}
            {% if comm.img %}
                <img class="postimg" src="{{comm.img.url }}">
            {% endif %}
        </div>

        <div class="seperate">
            <div class="line"></div>
        </div>

        <div class="commentsection">
            <h4>댓글</h4>
            {% if user.is_authenticated %}
            <form method="POST" action="{% url 'comment_create' pk=comm.pk %}">
                {% csrf_token %}
                <div>
                    {{ comment_form }}
                    <button type="submit">댓글 작성</button>
                </div>
            </form>
            {% else %}
            <a href="#">
                <div class="nocomment">로그인이 필요한 기능입니다</div>
            </a>
            {% endif %}
            
            {% if comm.comment_set.exists %}
                {% for comment in comm.comment_set.iterator %}
                <div id="{{comment.pk}}">
                    <!-- {{ comment.author.username }} -->
                    {{ comment.user.nickname }}
                    {{ comment.content }}
                    {% if comment.created_at != comment.modified_at %}
                        (수정됨){{ comment.modified_at }}
                    {% else %}
                        {{ comment.created_at }} 
                    {% endif %}
                    <a href="{% url 'comment_update' pk=comment.pk %}">수정</a>
                    <a href="{% url 'comment_delete' pk=comment.pk %}">삭제</a>
                    <br>
                    <!-- comment_update 함수에 댓글 pk전달 -->
                {% for recom in comment.recomment_set.all %}
                    &nbsp;&nbsp;🐾{{ recom.user.nickname }}:{{recom.content}} {{ created_at }}
                    <a href="{% url 'recomment_delete' rc_pk=recom.pk %}">삭제</a><br>
                {% endfor %}
                <form method="post" action="{% url 'recomment_create' c_pk=comment.pk %}">{%csrf_token%}
                    {{ recomment_form }}
                <input type="hidden" name="comment" value={{recomment.id}}>
                <input type="submit">
                </form>
                {% endfor %}
            {% endif %}

            </div>
        </div>
        {% include 'footer.html' %}
</body>
</html>